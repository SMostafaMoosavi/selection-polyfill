<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="cache-control" content="max-age=0" />
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
		<meta http-equiv="pragma" content="no-cache" />
		<meta charset="utf-8" />
		<title>Selection shiv</title>
	</head>
	<body>

		<div id="text" contenteditable="true">
			<p>Select <b>Bold</b></p>
			<p id="start">Para <b>Strong</b></p>
			<p>Para <b>Strong</b></p>
			<p id="end">Para <b>Strong</b></p>
		</div>
		<br/>
		<div id="output"></div>

		<script src="selection-shiv.js"></script>
		<script src="http://code.jquery.com/jquery.min.js"></script>
		<script>
		$(function() {

			$('#text').on('mouseup', function() {
				var selection = window.getSelection();
				if (selection.rangeCount > 0) {
					var range = selection.getRangeAt(0);
					range.setStart($('#start')[0].childNodes[0], 1);
					range.setEnd($('#end')[0].childNodes[0], 3);
					selection.removeAllRanges();
					selection.addRange(range);
				}
			});

			$(document).on('mouseup', function() {
				var selection = window.getSelection();
				if (selection.rangeCount > 0) {
					var range = selection.getRangeAt(0),
					ancestor = range.commonAncestorContainer,
					output = [
						'<br/>rangeCount: ',
						selection.rangeCount,
						'<br/>anchorOffset: ',
						selection.anchorOffset,

						'<br/>commonAncestorContainer: ',
						ancestor.tagType == 3 ? 'TEXT' : ancestor.tagName,

						'<br/>startContainer: ',
						range.startContainer.data,
						'<br/>startOffset: ',
						range.startOffset,

						'<br/>endContainer: ',
						range.endContainer.data,
						'<br/>endOffset: ',
						range.endOffset
					];
					$('#output').html(output.join(' '));
				}
			});

		});
		</script>
	</body>
</html>
